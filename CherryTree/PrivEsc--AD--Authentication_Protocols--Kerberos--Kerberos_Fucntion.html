<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Kerberos Fucntion</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Kerberos Fucntion</h1><br/><a href=""><img src="images/1803-1.png" alt="images/1803-1.png" /></a><br /><br />Part 1. Login<br />1. A request is sent from client to the domian controller. <br />   a) The domain controller must have the role of key distribution center and authentication server service. <br />   b) This transaction is refred to as the Authentication Server Request (AS_REQ).<br />   c) The AS_REQ contains a time stamp that is encrypted using a hash derived from the password and username of the user.<br />2A. The domain contorler attempts to decrypt the time stamp with the user name and password in its database.<br />   a) If the time stamp is a duplicate, authentication will be unsucsessful (this is to mitigate replay attacks).<br />2B. The controller sends the sends the client an Authentication Server Reply (AS_REP).<br />    a) The AS_REP containsa a “Session Key” and a “Ticket Granting Ticket” (TGT).<br />    b) The session key is encrypted using the user&#39;s password hash and can be decrypted by the client and reused.<br />    c) The TGT contains information about the client.<br />        1. Group membership.<br />        2. Domain name.<br />        3. Time stamp.<br />        4. Client IP address.<br />        5. Session key.<br />    d) The TGT is encrypted by a secret only known to the KDC and cannot be decrypted by the client.<br />Part 2. Access resources in the domain<br />3. The client creates and sends a “Ticket Granting Service Request” (TGS_REQ) to the KDC (key distribution center/domain controller).<br />    a) The TGS_REQ contains, current user.<br />    b) Time stamp (encrypted using the session key).<br />    c) SPN of the resource.<br />    d) Encrypted TGT.<br />4a. The KDC recieves the TGS_REQ.<br />    a) The KDC checks if the SPN exists.<br />    b) The TGT is decrypted (using the secret key only known to the KDC).<br />    c) The session key is extracted from the TGT and is used to decrypt the username and timestamp of the request.<br />    d) The KDC performs several checks.<br />        1. The TGT timestamp must be valid.<br />        2. The username from the TGS_REQ must match the username from the TGT.<br />        3. The client IP address must match the TGT IP address<br />4b. If all checks are passed the Ticket Granting Service of the KDC responds to the client with a Ticket Granting Server Reply (TGS_REP).<br />    a) The TGS_REP contains the SPN granted access to.<br />    b) The Session Key to be used between the client and the SPN.<br />    c) A Servcie Ticket containing.<br />        1. The username.<br />        2. Group Memberships.<br />        3. The newly created session key.<br />        Note- The whole Service Ticket is encrypted with the password hash of the service account registered with the SPN to be authenticated to. The SPN and new Session key inside of the Service Ticket are encrypted with the session key of the clients TGT. <br />        The client now has a session key and a service ticket.<br />5. The client sends the application server an Application Request (AP_REQ).<br />    a) The AP_REQ includes.<br />    b) The username and timestamp encrypted with the Session Key for the Service Ticket.<br />    c) The Session Key.<br />    d) The Service Ticket.<br />6a. The application server recieves the AP_REQ.<br />    a) The Service Ticket is decrypted using the service accounts&#39; password hash extracting the username and Session key.<br />    b) That Session Key is then used to decrypt the username from the AP_REQ.<br />    c) If the AP_REQ username matches the one decrypted from the Service Ticket the request is accepted.<br />    d) The service inspects the group memberships in the Service Ticket.<br />    e) If the proper permissions are held, then access will be granted to the service.<br />    <br />    <br /></div></body></html>